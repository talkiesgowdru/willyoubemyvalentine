<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Our Playlist | Sanctuary OS</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --bg: #000000;
            --apple-glass: rgba(15, 15, 15, 0.98);
            --accent: #1DB954;
            --border: rgba(255, 255, 255, 0.1);
            --dock-height: 100px;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg); color: #fff;
            overflow: hidden;
        }

        #bg-canvas { position: fixed; inset: 0; z-index: 0; opacity: 0.3; pointer-events: none; }
        .dynamic-bg { position: fixed; inset: 0; z-index: 1; transition: 1.5s; filter: brightness(0.3) blur(100px); }

        .back-nav {
            position: fixed; top: 30px; left: 30px; z-index: 9999;
            text-decoration: none; color: #fff; display: flex; align-items: center; gap: 10px;
            font-size: 0.7rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px;
            background: var(--apple-glass); padding: 12px 24px; border-radius: 50px;
            backdrop-filter: blur(25px); border: 1px solid var(--border);
        }

        .master-shell {
            display: flex; flex-direction: column; height: 100vh; width: 100vw; position: relative; z-index: 10;
        }

        .scroll-stage {
            flex: 1; overflow-y: auto; scrollbar-width: none; -webkit-overflow-scrolling: touch;
        }
        .scroll-stage::-webkit-scrollbar { display: none; }

        .playlist-header {
            padding: 120px 8% 60px; display: flex; align-items: flex-end; gap: 40px;
            background: linear-gradient(to bottom, rgba(29, 185, 84, 0.15), transparent);
        }
        .header-art {
            width: clamp(180px, 30vw, 240px); aspect-ratio: 1 / 1; border-radius: 12px; flex-shrink: 0;
            box-shadow: 0 40px 80px rgba(0,0,0,1); border: 1px solid var(--border);
            object-fit: cover;
        }
        .header-text h1 { font-family: 'Syncopate', sans-serif; font-size: clamp(28px, 6vw, 65px); letter-spacing: -4px; margin: 0; }

        .grid-wrapper {
            padding: 0 8% 40px; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 25px;
            max-width: 1400px; margin: 0 auto;
        }

        .track-card {
            background: rgba(255, 255, 255, 0.05); border-radius: 14px; padding: 20px; 
            transition: 0.4s; cursor: pointer; border: 1px solid transparent;
        }
        .track-card:hover { background: rgba(255, 255, 255, 0.1); border-color: var(--accent); transform: translateY(-8px); }
        .img-frame { width: 100%; aspect-ratio: 1 / 1; border-radius: 8px; overflow: hidden; margin-bottom: 15px; }
        .img-frame img { width: 100%; height: 100%; object-fit: cover; }
        .track-card h3 { font-size: 1rem; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 800; }
        .track-card p { font-size: 0.85rem; color: #b3b3b3; }

        .docked-bar {
            height: calc(var(--dock-height) + var(--safe-bottom)); 
            background: #121212; border-top: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px var(--safe-bottom); position: relative; z-index: 1000;
        }

        .dock-info { display: flex; align-items: center; gap: 15px; width: 30%; cursor: pointer; }
        .dock-info img { width: 56px; height: 56px; border-radius: 6px; object-fit: cover; }
        .dock-text h4 { font-size: 0.95rem; margin: 0; font-weight: 800; width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .dock-text p { font-size: 0.8rem; color: #b3b3b3; margin: 3px 0 0; }

        .dock-controls { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .play-btn { font-size: 45px !important; color: #fff; cursor: pointer; transition: 0.2s; }
        .nav-btn { font-size: 20px; color: #b3b3b3; cursor: pointer; }
        .nav-btn:hover { color: #fff; }

        .progress-engine { width: 100%; display: flex; align-items: center; gap: 15px; font-size: 11px; font-family: monospace; color: #888; }
        .rail { flex: 1; height: 4px; background: #333; border-radius: 10px; cursor: pointer; position: relative; }
        .fill { height: 100%; width: 0%; background: #fff; border-radius: 10px; pointer-events: none; }

        /* FULL VAULT OVERLAY */
        .full-vault {
            position: fixed; inset: 0; background: #000; z-index: 9000;
            display: none; flex-direction: column;
            padding: 40px 30px calc(40px + var(--safe-bottom)); box-sizing: border-box;
        }

        .vault-close {
            position: absolute; top: 40px; right: 30px; cursor: pointer; 
            font-size: 2rem; opacity: 0.6; z-index: 9005;
        }

        .unified-rigid-box {
            flex: 1; display: flex; flex-direction: column; align-items: center; 
            justify-content: center; width: 100%; max-width: 450px; margin: 0 auto;
        }

        .vault-art-box {
            width: 100%; aspect-ratio: 1 / 1; border-radius: 16px; 
            overflow: hidden; box-shadow: 0 40px 100px rgba(0,0,0,0.8);
            margin-bottom: 4vh; border: 1px solid var(--border);
        }
        .vault-art-box img { width: 100%; height: 100%; object-fit: cover; }

        .vault-meta { width: 100%; text-align: left; margin-bottom: 3vh; }
        .vault-meta h2 { font-size: clamp(24px, 4vh, 34px); font-weight: 900; margin: 0; letter-spacing: -1px; }
        .vault-meta p { font-size: 1.1rem; color: var(--accent); font-weight: 500; margin-top: 5px; }

        .vault-progress-container { width: 100%; margin-bottom: 4vh; }

        .vault-nav { 
            width: 100%; display: flex; justify-content: space-between; align-items: center;
        }

        .active-glow { color: var(--accent) !important; text-shadow: 0 0 15px var(--accent); }

        /* MOBILE OPTIMIZATION */
        @media (max-width: 850px) {
            .dock-text { display: none; }
            .playlist-header { flex-direction: column; align-items: center; text-align: center; padding-top: 100px; }
            .header-art { width: 220px; }
            
            .docked-bar { padding: 0 15px var(--safe-bottom); }
            .dock-info { width: auto; }
            .dock-controls { gap: 12px; }
            .progress-engine { max-width: 100% !important; }
            
            .grid-wrapper { grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 0 5% 40px; }
            .track-card { padding: 12px; }
        }

        @media (max-width: 500px) {
            .grid-wrapper { grid-template-columns: 1fr; }
            .track-card { display: flex; align-items: center; gap: 15px; }
            .img-frame { width: 60px; margin-bottom: 0; }
            .play-btn { font-size: 40px !important; }
            .nav-btn { font-size: 18px; }
        }

        @media (max-height: 750px) {
            .vault-art-box { max-width: 280px; }
        }
    </style>
</head>
<body onkeydown="handleGlobalKeys(event)">

<div class="dynamic-bg" id="bgLayer"></div>
<canvas id="bg-canvas"></canvas>
<a href="apps.html" class="back-nav"><i class="fas fa-chevron-left"></i> Sanctuary</a>

<div class="master-shell">
    <div class="scroll-stage">
        <header class="playlist-header">
            <img src="your_profile.jpg" class="header-art" id="playlist-art">
            <div class="header-text">
                <h1>OUR PLAYLIST</h1>
                <p style="color:var(--accent); font-weight:800; font-size:12px; margin-top:12px; text-transform:uppercase; letter-spacing:2px;">Sanctuary OS Native Player</p>
            </div>
        </header>
        <div class="grid-wrapper" id="grid"></div>
    </div>

    <footer class="docked-bar">
        <div class="dock-info" onclick="toggleVault(true)">
            <img src="your_profile.jpg" id="m-img">
            <div class="dock-text">
                <h4 id="m-title">Select Track</h4>
                <p id="m-artist">Sanctuary OS</p>
            </div>
        </div>
        <div class="dock-controls">
            <div style="display: flex; align-items: center; gap: clamp(15px, 5vw, 30px);">
                <i class="fa-solid fa-shuffle nav-btn" id="m-shuf" onclick="handleShuffle()"></i>
                <i class="fa-solid fa-backward-step nav-btn" onclick="prev()"></i>
                <i class="fa-solid fa-circle-play play-btn" id="m-play" onclick="togglePlay()"></i>
                <i class="fa-solid fa-forward-step nav-btn" onclick="next()"></i>
                <i class="fa-solid fa-repeat nav-btn" id="m-rep" onclick="handleRepeat()"></i>
            </div>
            <div class="progress-engine" style="width: 100%; max-width: 500px;">
                <span id="cur-m">0:00</span>
                <div class="rail" onclick="seek(event)"><div class="fill" id="fill-m"></div></div>
                <span id="dur-m">0:00</span>
            </div>
        </div>
        <div class="side-spacer" style="width: 10%; min-width: 0;"></div>
    </footer>
</div>

<div class="full-vault" id="vault">
    <div class="vault-close" onclick="toggleVault(false)">
        <i class="fas fa-chevron-down"></i>
    </div>
    
    <div class="unified-rigid-box">
        <div class="vault-art-box"><img src="" id="f-img"></div>
        <div class="vault-meta">
            <h2 id="f-title">Track Name</h2>
            <p id="f-artist">Artist Name</p>
        </div>

        <div class="vault-progress-container">
            <div class="progress-engine">
                <span id="cur-f">0:00</span>
                <div class="rail" onclick="seek(event)"><div class="fill" id="fill-f"></div></div>
                <span id="dur-f">0:00</span>
            </div>
        </div>

        <div class="vault-nav">
            <i class="fa-solid fa-shuffle nav-btn" id="f-shuf" style="font-size:22px;" onclick="handleShuffle()"></i>
            <div style="display: flex; align-items: center; gap: 40px;">
                <i class="fa-solid fa-backward-step nav-btn" style="font-size: 32px;" onclick="prev()"></i>
                <i class="fa-solid fa-circle-play play-btn" id="f-play" style="font-size: 85px; color: var(--accent);" onclick="togglePlay()"></i>
                <i class="fa-solid fa-forward-step nav-btn" style="font-size: 32px;" onclick="next()"></i>
            </div>
            <i class="fa-solid fa-repeat nav-btn" id="f-rep" style="font-size:22px;" onclick="handleRepeat()"></i>
        </div>
    </div>
</div>

<audio id="audio" preload="auto"></audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
    const audio = document.getElementById('audio');
    const trackData = [
        { id: 0, title: "Telephone Gelathi", artist: "Rajesh Krishnan", img: "track1.jpg", url: "track1.mp3", accent: "#ff3b30" },
        { id: 1, title: "Chendutiya Pakkadali", artist: "Sonu Nigam, V. Harikrishna", img: "track12.jpg", url: "track12.mp3", accent: "#fbc02d" },
        { id: 2, title: "Yaare Yaare", artist: "Armaan Malik", img: "track4.jpg", url: "track4.mp3", accent: "#007aff" },
        { id: 3, title: "Yenappa Sangathi", artist: "Tippu", img: "track5.jpeg", url: "track5.mp3", accent: "#af52de" },
        { id: 4, title: "Mungaru Maleyalli", artist: "Sonu Nigam", img: "track3.jpg", url: "track3.mp3", accent: "#1DB954" },
        { id: 5, title: "Sevanthiye Sevanthiye", artist: "V. Manohar, S. P. Balasubrahmanyam", img: "track7.jpeg", url: "track8.mp3", accent: "#5856d6" },
        { id: 6, title: "Mr. & Mrs. Ramachari", artist: "Vijay Prakash", img: "track5.jpeg", url: "track6.mp3", accent: "#fbc02d" },
        { id: 7, title: "Anisuthide", artist: "Sonu Nigam", img: "track9.jpg", url: "track9.mp3", accent: "#1DB954" },
        { id: 8, title: "Belli Chukki Baaninalli", artist: "S. P. Balasubramanyam, K.S. Chithra", img: "track7.jpeg", url: "track7.mp3", accent: "#ff3b30" },
        { id: 9, title: "Mathu Nannolu", artist: "Sonu Nigam, Shreya Goshal, V.Harikrishna", img: "track10.jpg", url: "track10.mp3", accent: "#007aff" },
        { id: 10, title: "Jum Jum Maya", artist: "Ajay Warrior, Anuradha Bhat", img: "track11.jpg", url: "track11.mp3", accent: "#af52de" },
        { id: 11, title: "Naane Neenanthe", artist: "Sid Sriram", img: "track2.jpeg", url: "track2.mp3", accent: "#5856d6" },
    ];

    let queue = [...trackData], curIdx = -1, isS = false, isR = false;

    function init() {
        const grid = document.getElementById('grid');
        trackData.forEach((t) => {
            const card = document.createElement('div');
            card.className = 'track-card';
            card.innerHTML = `<div class="img-frame"><img src="${t.img}"></div><div><h3>${t.title}</h3><p>${t.artist}</p></div>`;
            card.onclick = () => { const idx = queue.findIndex(x => x.id === t.id); play(idx); };
            grid.appendChild(card);
        });
    }

    function play(idx) {
        if(idx < 0 || idx >= queue.length) return;
        curIdx = idx; const t = queue[curIdx]; audio.src = t.url; audio.play();
        document.getElementById('m-img').src = document.getElementById('f-img').src = document.getElementById('playlist-art').src = t.img;
        document.getElementById('m-title').innerText = document.getElementById('f-title').innerText = t.title;
        document.getElementById('m-artist').innerText = document.getElementById('f-artist').innerText = t.artist;
        document.getElementById('bgLayer').style.background = `radial-gradient(circle at center, ${t.accent} 0%, #000 100%)`;
        updateIcons(true);
    }

    function togglePlay() { 
        if(curIdx === -1) { play(0); return; } 
        audio.paused ? audio.play() : audio.pause(); updateIcons(!audio.paused); 
    }

    function updateIcons(p) { 
        const icon = p ? 'fa-solid fa-circle-pause' : 'fa-solid fa-circle-play';
        document.getElementById('m-play').className = document.getElementById('f-play').className = icon + ' play-btn';
    }

    function next() { play((curIdx + 1) % queue.length); }
    function prev() { play((curIdx - 1 + queue.length) % queue.length); }

    function handleGlobalKeys(e) {
        if(e.code === "Space") { e.preventDefault(); togglePlay(); }
        if(e.code === "ArrowRight") next();
        if(e.code === "ArrowLeft") prev();
    }

    function handleShuffle() {
        isS = !isS; 
        document.getElementById('m-shuf').classList.toggle('active-glow', isS); 
        document.getElementById('f-shuf').classList.toggle('active-glow', isS);
        if(isS) { 
            for (let i = queue.length - 1; i > 0; i--) { 
                const j = Math.floor(Math.random() * (i + 1)); 
                [queue[i], queue[j]] = [queue[j], queue[i]]; 
            } 
        } else { 
            queue = [...trackData]; 
        }
    }

    function handleRepeat() { 
        isR = !isR; 
        document.getElementById('m-rep').classList.toggle('active-glow', isR); 
        document.getElementById('f-rep').classList.toggle('active-glow', isR); 
    }

    function toggleVault(show) { 
        const v = document.getElementById('vault');
        if(show) { 
            v.style.display = 'flex'; 
            gsap.fromTo(v, {y: '100%'}, {y: '0%', duration: 0.6, ease: "expo.out"}); 
        } else { 
            gsap.to(v, {y: '100%', duration: 0.5, ease: "power2.inOut", onComplete: () => v.style.display = 'none'}); 
        }
    }

    audio.onended = () => { if(isR) { audio.currentTime = 0; audio.play(); } else { next(); } };
    
    audio.ontimeupdate = () => {
        const p = (audio.currentTime / audio.duration) * 100; 
        const time = fmt(audio.currentTime);
        const total = audio.duration ? fmt(audio.duration) : "0:00";

        document.getElementById('fill-m').style.width = p + '%';
        document.getElementById('cur-m').innerText = time;
        document.getElementById('dur-m').innerText = total;

        document.getElementById('fill-f').style.width = p + '%';
        document.getElementById('cur-f').innerText = time;
        document.getElementById('dur-f').innerText = total;
    };

    function seek(e) { 
        const rect = e.currentTarget.getBoundingClientRect();
        const x = e.clientX - rect.left;
        audio.currentTime = (x / rect.width) * audio.duration; 
    }

    function fmt(s) { if(isNaN(s)) return "0:00"; const m = Math.floor(s/60); const sc = Math.floor(s%60); return `${m}:${sc < 10 ? '0' : ''}${sc}`; }

    const cvs = document.getElementById('bg-canvas');
    const ctx = cvs.getContext('2d');
    function resize() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
    window.addEventListener('resize', resize); resize();
    let pts = [];
    class P { 
        constructor() { this.init(); }
        init() { this.x=Math.random()*cvs.width; this.y=Math.random()*cvs.height; this.s=Math.random()*1.2; this.v=Math.random()*0.2; }
        upd(){ this.y-=this.v; if(this.y<0) this.init(); } 
        drw(){ ctx.globalAlpha=0.15; ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(this.x,this.y,this.s,0,Math.PI*2); ctx.fill(); } 
    }
    for(let i=0; i<60; i++) pts.push(new P());
    function anim() { ctx.clearRect(0,0,cvs.width,cvs.height); pts.forEach(p=>{p.upd();p.drw();}); requestAnimationFrame(anim); } 
    anim();

    init();
</script>
</body>
</html>
